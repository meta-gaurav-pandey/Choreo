<?xml version="1.0" encoding="UTF-8"?>
<sequence name="DataBaseSchedulerSequence" onError="ErrorSequence" trace="disable" xmlns="http://ws.apache.org/ns/synapse">
    <property expression="get-property('SYSTEM_TIME')" name="currentTime" scope="default" type="STRING"/>
    <script language="js"><![CDATA[var currentTime = mc.getProperty('currentTime');
    var timestamp = new Date(parseInt(currentTime));
  print(timestamp.toISOString());
    mc.setProperty('formattedTime1', timestamp.toISOString().replace('Z',''));]]></script>
    <script language="js"><![CDATA[var currentTime = new Date();
 currentTime.setMinutes(currentTime.getMinutes()-10);
print(currentTime.toISOString());
    mc.setProperty('formattedTime2', currentTime.toISOString().replace('Z',''));]]></script>
    <property expression="get-property('formattedTime1')" name="formattedTime1" scope="default" type="STRING"/>
    <property expression="get-property('formattedTime2')" name="formattedTime2" scope="default" type="STRING"/>
    <log separator=",">
        <property expression="get-property('formattedTime1')" name="time1"/>
        <property expression="get-property('formattedTime2')" name="time2"/>
    </log>
    <clone>
        <target>
            <sequence>
                <property name="source" scope="default" type="STRING" value="dbpedia"/>
                <dataServiceCall serviceName="RDBMSdataService">
                    <operations type="single">
                        <operation name="TriggerCall">
                            <param evaluator="xml" expression="get-property('source')" name="sourceName"/>
                            <param evaluator="xml" expression="get-property('formattedTime2')" name="from"/>
                            <param evaluator="xml" expression="get-property('formattedTime1')" name="to"/>
                        </operation>
                    </operations>
                    <source type="inline"/>
                    <target type="body"/>
                </dataServiceCall>
                <property name="messageType" scope="axis2" type="STRING" value="application/xml"/>
                <property name="sObjectType" scope="default" type="STRING" value="ApiData"/>
                <sequence key="ClassSequence"/>
                <payloadFactory media-type="json">
                    <format>$1</format>
                    <args>
                        <arg evaluator="json" expression="$ctx:Array"/>
                    </args>
                </payloadFactory>
                <call>
                    <endpoint>
                        <http method="post" statistics="enable" uri-template="http://52.91.255.31:8080/ttl/generate/ttl?entityType=OrganisationMapping">
                            <suspendOnFailure>
                                <initialDuration>-1</initialDuration>
                                <progressionFactor>-1</progressionFactor>
                                <maximumDuration>0</maximumDuration>
                            </suspendOnFailure>
                            <markForSuspension>
                                <retriesBeforeSuspension>0</retriesBeforeSuspension>
                            </markForSuspension>
                        </http>
                    </endpoint>
                </call>
                <log level="full"/>
                <call>
                    <endpoint>
                        <http method="post" uri-template="http://52.91.255.31:8080/insertion/insertDataIntoGraph">
                            <suspendOnFailure>
                                <initialDuration>-1</initialDuration>
                                <progressionFactor>-1</progressionFactor>
                                <maximumDuration>0</maximumDuration>
                            </suspendOnFailure>
                            <markForSuspension>
                                <retriesBeforeSuspension>0</retriesBeforeSuspension>
                            </markForSuspension>
                        </http>
                    </endpoint>
                </call>
                <log level="full">
                    <property name="EndLog" value="Api end log"/>
                </log>
            </sequence>
        </target>
        <target>
            <sequence>
                <property name="source" scope="default" type="STRING" value="salesforce"/>
                <dataServiceCall serviceName="RDBMSdataService">
                    <operations type="single">
                        <operation name="TriggerCall">
                            <param evaluator="xml" expression="get-property('source')" name="sourceName"/>
                            <param evaluator="xml" expression="get-property('formattedTime2')" name="from"/>
                            <param evaluator="xml" expression="get-property('formattedTime1')" name="to"/>
                        </operation>
                    </operations>
                    <source type="inline"/>
                    <target type="body"/>
                </dataServiceCall>
                <property name="messageType" scope="axis2" type="STRING" value="application/xml"/>
                <property name="sObjectType" scope="default" type="STRING" value="ApiData"/>
                <sequence key="ClassSequence"/>
                <payloadFactory media-type="json">
                    <format>$1</format>
                    <args>
                        <arg evaluator="json" expression="$ctx:Array"/>
                    </args>
                </payloadFactory>
                <call>
                    <endpoint>
                        <http method="post" statistics="enable" uri-template="http://52.91.255.31:8080/ttl/generate/ttl?entityType=OrganisationMapping">
                            <suspendOnFailure>
                                <initialDuration>-1</initialDuration>
                                <progressionFactor>-1</progressionFactor>
                                <maximumDuration>0</maximumDuration>
                            </suspendOnFailure>
                            <markForSuspension>
                                <retriesBeforeSuspension>0</retriesBeforeSuspension>
                            </markForSuspension>
                        </http>
                    </endpoint>
                </call>
                <log level="full"/>
                <call>
                    <endpoint>
                        <http method="post" uri-template="http://52.91.255.31:8080/insertion/insertDataIntoGraph">
                            <suspendOnFailure>
                                <initialDuration>-1</initialDuration>
                                <progressionFactor>-1</progressionFactor>
                                <maximumDuration>0</maximumDuration>
                            </suspendOnFailure>
                            <markForSuspension>
                                <retriesBeforeSuspension>0</retriesBeforeSuspension>
                            </markForSuspension>
                        </http>
                    </endpoint>
                </call>
                <log level="full">
                    <property name="EndLog" value="Api end log"/>
                </log>
            </sequence>
        </target>
        <target>
            <sequence>
                <property name="source" scope="default" type="STRING" value="dbpedia"/>
                <dataServiceCall serviceName="RDBMSdataService">
                    <operations type="single">
                        <operation name="TriggerCall">
                            <param evaluator="xml" expression="get-property('source')" name="sourceName"/>
                            <param evaluator="xml" expression="get-property('formattedTime2')" name="from"/>
                            <param evaluator="xml" expression="get-property('formattedTime1')" name="to"/>
                        </operation>
                    </operations>
                    <source type="inline"/>
                    <target type="body"/>
                </dataServiceCall>
                <property name="messageType" scope="axis2" type="STRING" value="application/xml"/>
                <property name="sObjectType" scope="default" type="STRING" value="ApiData"/>
                <sequence key="ClassSequence"/>
                <payloadFactory media-type="json">
                    <format>$1</format>
                    <args>
                        <arg evaluator="json" expression="$ctx:Array"/>
                    </args>
                </payloadFactory>
                <call>
                    <endpoint>
                        <http method="post" statistics="enable" uri-template="http://52.91.255.31:8080/ttl/generate/ttl?entityType=OrganisationMapping">
                            <suspendOnFailure>
                                <initialDuration>-1</initialDuration>
                                <progressionFactor>-1</progressionFactor>
                                <maximumDuration>0</maximumDuration>
                            </suspendOnFailure>
                            <markForSuspension>
                                <retriesBeforeSuspension>0</retriesBeforeSuspension>
                            </markForSuspension>
                        </http>
                    </endpoint>
                </call>
                <log level="full"/>
                <call>
                    <endpoint>
                        <http method="post" uri-template="http://52.91.255.31:8080/insertion/insertDataIntoGraph">
                            <suspendOnFailure>
                                <initialDuration>-1</initialDuration>
                                <progressionFactor>-1</progressionFactor>
                                <maximumDuration>0</maximumDuration>
                            </suspendOnFailure>
                            <markForSuspension>
                                <retriesBeforeSuspension>0</retriesBeforeSuspension>
                            </markForSuspension>
                        </http>
                    </endpoint>
                </call>
                <log level="full">
                    <property name="EndLog" value="Api end log"/>
                </log>
            </sequence>
        </target>
    </clone>
</sequence>
